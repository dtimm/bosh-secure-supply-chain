---
resources:
- name: bpm-release
  type: git
  source:
    uri: git@github.com:cloudfoundry/bpm-release.git
    branch: master
    private_key: ((signing_test.private_key))
- name: bosh-sbom-link
  type: git
  source:
    uri: git@github.com:dtimm/bosh-secure-supply-chain.git
    branch: main
    private_key: ((signing_test.private_key))
- name: signing-key
  type: git
  source:
    uri: git@github.com:dtimm/secrets.git
    branch: main
    private_key: ((signing_test.secrets_private_key))

jobs:
- name: generate-sbom-provenance
  serial: true
  plan:
  - in_parallel:
    - get: bpm-release
    - get: bosh-sbom-link
    - get: signing-key
  - task: generate-gomod-sbom
    file: bosh-sbom-link/concourse/gomod/task.yml
    input_mapping:
      bosh-release: bpm-release
    params:
      PACKAGE_NAME: bpm
  - task: sign-sboms
    file: bosh-sbom-link/concourse/sign/task.yml

